<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>StringCache Class</title><meta name="Language" content="en-us" /><meta name="System.Keywords" content="StringCache class" /><meta name="System.Keywords" content="Au.Util.StringCache class" /><meta name="System.Keywords" content="StringCache class, about StringCache class" /><meta name="Microsoft.Help.F1" content="Au.Util.StringCache" /><meta name="Microsoft.Help.Id" content="T:Au.Util.StringCache" /><meta name="Description" content="Caches managed strings created from unmanaged char* buffers." /><meta name="Microsoft.Help.ContentType" content="Reference" /><meta name="BrandingAware" content="true" /><meta name="container" content="Au.Util" /><meta name="file" content="T_Au_Util_StringCache" /><meta name="guid" content="T_Au_Util_StringCache" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Au Class Library<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="3d4fd35d-4b48-4167-b34f-44e9afc13fc3.htm" title="Au Class Library" tocid="roottoc">Au Class Library</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="N_Au_Util.htm" title="Au.Util" tocid="N_Au_Util">Au.Util</a></div><div class="toclevel1 current" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="T_Au_Util_StringCache.htm" title="StringCache Class" tocid="T_Au_Util_StringCache">StringCache Class</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Au_Util_StringCache__ctor.htm" title="StringCache Constructor " tocid="M_Au_Util_StringCache__ctor">StringCache Constructor </a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Properties_T_Au_Util_StringCache.htm" title="StringCache Properties" tocid="Properties_T_Au_Util_StringCache">StringCache Properties</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Methods_T_Au_Util_StringCache.htm" title="StringCache Methods" tocid="Methods_T_Au_Util_StringCache">StringCache Methods</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>StringCache Class</h1></td></tr></table><span class="introStyle"></span> <div class="summary">
            Caches managed strings created from unmanaged char* buffers.
            </div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Inheritance Hierarchy</span></div><div id="ID0RBSection" class="collapsibleSection"><a href="http://msdn2.microsoft.com/en-us/library/e5kfa45b" target="_blank">System<span id="LSTEAFDB390_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTEAFDB390_0?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Object</a><br />  <span class="selflink">Au.Util<span id="LSTEAFDB390_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTEAFDB390_1?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>StringCache</span><br /></div><p> </p>
    <strong>Namespace:</strong> 
   <a href="N_Au_Util.htm">Au.Util</a><br />
    <strong>Assembly:</strong>
   Au (in Au.dll) Version: 1.0.0.0<div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Syntax</span></div><div id="ID2RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EACA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EACA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EACA');return false;" title="Copy">Copy</a></div></div><div id="ID1EACA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="keyword">public</span> <span class="keyword">class</span> <span class="identifier">StringCache</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EACA");</script></div><p>The <span class="selflink">StringCache</span> type exposes the following members.</p><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Constructors</span></div><div id="ID3RBSection" class="collapsibleSection"><table class="members" id="constructorList"><tr><th class="iconColumn">
								 
							</th><th>Name</th><th>Description</th></tr><tr data="public;declared;notNetfw;"><td><img src="../icons/pubmethod.gif" alt="Public method" title="Public method" /></td><td><a href="M_Au_Util_StringCache__ctor.htm">StringCache</a></td><td><div class="summary">Initializes a new instance of the <span class="selflink">StringCache</span> class</div></td></tr></table><a href="#PageHeader">Top</a></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Properties</span></div><div id="ID4RBSection" class="collapsibleSection"><table class="members" id="propertyList"><tr><th class="iconColumn">
								 
							</th><th>Name</th><th>Description</th></tr><tr data="public;declared;notNetfw;"><td><img src="../icons/pubproperty.gif" alt="Public property" title="Public property" /></td><td><a href="P_Au_Util_StringCache_Count.htm">Count</a></td><td><div class="summary">
            Number of elements in this cache.
            </div></td></tr></table><a href="#PageHeader">Top</a></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Methods</span></div><div id="ID5RBSection" class="collapsibleSection"><table class="members" id="methodList"><tr><th class="iconColumn">
								 
							</th><th>Name</th><th>Description</th></tr><tr data="public;declared;notNetfw;"><td><img src="../icons/pubmethod.gif" alt="Public method" title="Public method" /></td><td><a href="M_Au_Util_StringCache_Add.htm">Add</a></td><td><div class="summary">
            Searches in the cache for a managed string that matches unmanaged string p of length len.<br />
            If finds, returns it. Else adds <span class="code">new string(p, 0, len)</span> to the cache and returns it.
            </div></td></tr></table><a href="#PageHeader">Top</a></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID6RB')" onkeypress="SectionExpandCollapse_CheckKey('ID6RB', event)" tabindex="0"><img id="ID6RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Remarks</span></div><div id="ID6RBSection" class="collapsibleSection">
            Can be used in possibly very frequently called functions to avoid much string garbage and frequent garbage collections.<br />
            For example, Wnd.ClassName and Wnd.Name use this. They are called by Wnd.Find for each window (can be hundreds of them). And WaitFor.WindowExists calls Wnd.Find every 30 or so milliseconds. It could create megabytes of garbage (window classname and name strings) in a few seconds. Every Wnd.Find call creates almost the same set of strings, therefore it makes sense to cache them.<br />
            To allow GC free the cached strings, use a WeakReferenc&lt;StringCache&gt; object. See example.</div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID7RB')" onkeypress="SectionExpandCollapse_CheckKey('ID7RB', event)" tabindex="0"><img id="ID7RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Examples</span></div><div id="ID7RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAAABA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAAABA');return false;" title="Copy">Copy</a></div></div><div id="ID1EAAABA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">internal</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">unsafe</span> <span class="highlight-keyword">string</span> GetCachedString(<span class="highlight-keyword">char</span>* p, <span class="highlight-keyword">int</span> len)
{
    <span class="highlight-keyword">lock</span>(_cacheWR) {
        <span class="highlight-keyword">if</span>(!_cacheWR.TryGetTarget(<span class="highlight-keyword">out</span> <span class="highlight-keyword">var</span> cache)) _cacheWR.SetTarget(cache = <span class="highlight-keyword">new</span> StringCache());
        <span class="highlight-keyword">return</span> cache.Add(p, len);
    }
}
<span class="highlight-keyword">static</span> WeakReference&lt;StringCache&gt; _cacheWR = <span class="highlight-keyword">new</span> WeakReference&lt;StringCache&gt;(<span class="highlight-keyword">null</span>);

<span class="highlight-comment">//When char[] is used as text buffer.</span>
<span class="highlight-keyword">internal</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">unsafe</span> <span class="highlight-keyword">string</span> GetCachedString(<span class="highlight-keyword">char</span>[] a, <span class="highlight-keyword">int</span> len)
{
    Debug.Assert(len &lt; a.Length);
    <span class="highlight-keyword">fixed</span> (<span class="highlight-keyword">char</span>* p = a) <span class="highlight-keyword">return</span> GetCachedString(p, len);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAAABA");</script></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID8RB')" onkeypress="SectionExpandCollapse_CheckKey('ID8RB', event)" tabindex="0"><img id="ID8RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID8RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="N_Au_Util.htm">Au.Util Namespace</a></div></div></div></div><div id="pageFooter" class="pageFooter"> </div></body></html>